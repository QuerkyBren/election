<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>TVF Elections</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.5/css/bootstrap.min.css" integrity="sha256-mIfhv/h3MLq3WSiSlduuZO3saRNzzuf1LK8w3z3l3JY=" crossorigin="anonymous" />
    </head>
    <body>
        <header class="jumbotron jumbotron-fluid">
            <div class="container">
                <h1 class="display-3"><b>Versutian</b> Elections</h1>
                <p class="lead">Welcome to the official voting site for the Versutian Federation.</p>
                <p>Here, you may cast your ballot for current elections to participate in our democracy with a simple two step process &mdash; no registration required.</p>
                <a class="btn btn-secondary" href="faq.html">Learn more</a>
            </div>
        </header>
        
        <section id="elections" class="container">
            <h1>1. Login with NationStates</h1>
            <div id="alert"></div>
            <form>
                <div class="form-group" id="nation-name-group">
                    <input type="text" class="form-control form-control-lg" id="nation-name" aria-describedby="nationHelpBlock" placeholder="Nation name">
                    <div id="nation-name-feedback"></div>
                    <p id="nationHelpBlock" class="form-text text-muted">
                        Your nation's short name, as it is displayed on NationStates, for example, North Arkana.
                    </p>
                </div>
            </form>
            <br>
            <iframe src="https://www.nationstates.net/page=verify_login#proof_of_login_checksum" style="border:none; height: 33vh; width: 100%"></iframe>
            <br>
            <form>
                <div class="form-group" id="verification-code-group">
                    <input type="text" class="form-control" id="verification-code" aria-describedby="codeHelpBlock" placeholder="Code">
                    <div id="verification-code-feedback"></div>
                    <p id="codeHelpBlock" class="form-text text-muted">
                        Copy the code you see from the NationStates.net page into this box.
                    </p>
                </div>
            </form>
            <br>
            <button class="btn btn-primary" onclick="verify()">Login</button>
            <br><br>
        </section>
        
        <script>
            var nationName;
            var internalName;
            var verificationCode;
            var accessLevel = "CITIZEN";
            var officials = ["north_arkana", "asairia"];
            var protectors = ["alamei"];
            function verify() {
                document.getElementById('nation-name-feedback').innerHTML = '';
                document.getElementById('nation-name-group').classList.remove('has-warning');
                document.getElementById('verification-code-feedback').innerHTML = '';
                document.getElementById('verification-code-group').classList.remove('has-warning');
                nationName = document.getElementById('nation-name').value;
                internalName = nationName.toLowerCase().replace(/ /g, "_");
                verificationCode = document.getElementById('verification-code').value;
                var invalid = false;
                if (nationName == null || nationName == "") {
                    document.getElementById('nation-name-group').classList.add('has-warning');
                    document.getElementById('nation-name-feedback').innerHTML = '<div class="form-control-feedback">Something\'s not right about that nation name.</div>';
                    invalid = true;
                }
                // TODO: verify code is valid
                if (verificationCode == null || verificationCode == "") {
                    document.getElementById('verification-code-group').classList.add('has-warning');
                    document.getElementById('verification-code-feedback').innerHTML = '<div class="form-control-feedback">Your verification code was not approved. Try getting a new code.</div>';
                    invalid = true;
                }
                if (invalid) {
                    return;
                }
                var elections = document.getElementById('elections');
                if (officials.indexOf(internalName) != -1) {
                    accessLevel = "OFFICIAL";
                } else if (protectors.indexOf(internalName) != -1) {
                    accessLevel = "PROTECTOR";
                }
                elections.innerHTML = '<h1>2. Vote</h1>';
                elections.innerHTML += '<p class="lead">Vote on these elections, ' + nationName + '.</p>';
                elections.innerHTML += '<div class="card card-block"><h4 class="card-title">Delegate</h4><div id="inner-vote"><button class="btn btn-secondary" onclick="vote()">North Arkana <small>Incumbent</small></button><button class="btn btn-secondary" onclick="vote()">Opponent</button></div></div>';
                if (accessLevel === "OFFICIAL" || accessLevel === "PROTECTOR") {
                    elections.innerHTML += '<hr>';
                    elections.innerHTML += '<h2>Create new election</h2>';
                    elections.innerHTML += '<form><div class="form-group"><input type="text" class="form-control" id="election-name" placeholder="Election name"></div><div class="form-group"><label>Candidates</label><input type="text" class="form-control" id="election-name" placeholder="Nation name"> <br><input type="text" class="form-control" id="election-name" placeholder="Nation name"></div></form> <br><button class="btn btn-primary" onclick="add()">Create election</button><br>';
                }
            }
            
            function add() {
                
            }
            
            function vote() {
                var innerVote = document.getElementById('inner-vote');
                innerVote.innerHTML = '<p class="card-text">Thank you for voting!</p>';
                innerVote.innerHTML += '<div class="text-xs-center"><b>North Arkana</b> 100%</div>';
                innerVote.innerHTML += '<progress class="progress" value="100" max="100"></progress>';
                innerVote.innerHTML += '<div class="text-xs-center"><b>Opponent</b> 0%</div>';
                innerVote.innerHTML += '<progress class="progress" value="0" max="100"></progress>';
            }
        </script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js" integrity="sha256-/5pHDZh2fv1eZImyfiThtB5Ag4LqDjyittT7fLjdT/8=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.5/js/bootstrap.min.js" integrity="sha256-j+XrvkQ4jJ99Hj0pJKPr6k0RCgxDDSTs3PBqLrX2EMc=" crossorigin="anonymous"></script>
    </body>
</html>